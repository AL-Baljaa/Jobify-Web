<html>
<head>
  <title>Employer page</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-light">
  <header class="bg-primary text-white p-3 sticky-top">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <img src="jobify.png" alt="Jobify Logo" class="img-fluid" style="height: 2.5em;">
      <div>
        <a href="signin.html" class="btn btn-outline-light me-2">Sign In</a>
        <a href="signup.html" class="btn btn-warning">Sign Up</a>
      </div>
    </div>
  </header>

  <!-- Navigation bar-->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link " href="home.html"><i class="fas fa-home me-1"></i> Home</a></li>
                <li class="nav-item"><a class="nav-link" href="job-listing.html"><i class="fas fa-search me-1"></i> Job Listing</a></li>
                <li class="nav-item"><a class="nav-link" href="job-seeker.html"><i class="fas fa-users me-1"></i> Job Seeker</a></li>
                <li class="nav-item"><a class="nav-link active" href="employer.html"><i class="fas fa-briefcase me-1"></i> Employer</a></li>
                <li class="nav-item"><a class="nav-link" href="trainee.html"><i class="fas fa-project-diagram me-1"></i> Trainee and Undergraduate</a></li>
                <li class="nav-item"><a class="nav-link" href="skills.html"><i class="fas fa-chalkboard me-1"></i> Skill Development</a></li>
                <li class="nav-item"><a class="nav-link" href="questionnaire.html"><i class="fas fa-clipboard-check"></i> Questionnaire</a></li>
                <li class="nav-item"><a class="nav-link" href="funpage.html"><i class="fas fa-gamepad"></i> fun page</a></li>
                <li class="nav-item"><a class="nav-link" href="calculate.html"><i class="fas fa-equals"></i> calculate page</a></li>
            </ul>
        </div>
    </div>
</nav>

  <main class="container my-4">

    <!-- Employer Profile Section -->
    <div class="card mb-4 rounded">
      <div class="card-body">
        <h3 class="section-title">Update Your Profile</h3>
        <form id="employerProfileForm" class="forms">
          <div class="mb-3">
            <label for="company-name">🏢 Company Name</label>
            <input type="text" class="form-control" id="company-name" placeholder="Enter company name" required>
          </div>
          <div class="mb-3">
            <label for="location">📍 Location</label>
            <input type="text" class="form-control" id="location" placeholder="e.g., Muscat, Dubai">
          </div>
          <div class="mb-3">
            <label for="industry">🏭 Industry</label>
            <input type="text" class="form-control" id="industry" placeholder="e.g., Tech, Healthcare">
          </div>
          <div class="mb-3">
            <label for="company-description">📝 Company Description</label>
            <textarea class="form-control" id="company-description" placeholder="Describe your company..."></textarea>
          </div>
          <div class="mb-3">
            <label for="logo">📄 Upload Company Logo</label>
            <input class="form-control" type="file" id="logo">
          </div>
          <button type="submit" class="btn btn-primary">💾 Save Profile</button>
        </form>
      </div>
    </div>

    <!-- Post a Job Section -->
    <div class="card mb-4 rounded">
      <div class="card-body">
        <h3 class="section-title">Post a Job</h3>
        <form id="postJobForm" class="forms">
          <div class="mb-3">
            <label for="job-title">💼 Job Title</label>
            <input type="text" class="form-control" id="job-title" placeholder="e.g., Software Engineer" required>
          </div>
          <div class="mb-3">
            <label for="salary">💵 Salary</label>
            <input type="text" class="form-control" id="salary" placeholder="e.g., $1,000 - $10,000">
          </div>
          <div class="mb-3">
            <label for="job-description">📄 Job Description</label>
            <textarea class="form-control" id="job-description" placeholder="Describe the work and the roles..."></textarea>
          </div>
          <div class="mb-3">
            <label for="job-location">📍 Location</label>
            <input type="text" class="form-control" id="job-location" placeholder="e.g., Muscat, Dubai, ...">
          </div>
          <button type="submit" class="btn btn-primary">📤 Post Job</button>
        </form>
      </div>
    </div>

    <!-- Posted Jobs Section -->
    <div class="card mb-4 rounded">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="section-title">📋 Posted Jobs</h3>
          <div class="col-md-4">
            <input type="text" class="form-control" id="searchJobs" placeholder="Search jobs...">
          </div>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Job Title</th>
                <th>Company</th>
                <th>Location</th>
                <th>Description</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="postedJobsBody">
              <!-- Filled by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Manage Applications Section -->
    <div class="card mb-4 rounded">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="section-title">📝 Manage Applications</h3>
          <div class="col-md-4">
            <input type="text" class="form-control" id="searchApplications" placeholder="Search applications...">
          </div>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Job Title</th>
                <th>Candidate</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="applicationsBody">
              <!-- Filled by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Communicate with Candidates Section -->
    <div class="card mb-4 rounded">
      <div class="card-body">
        <h3 class="section-title">💬 Communicate with Candidates</h3>
        <div id="candidateMessages">
          <!-- Filled by JavaScript -->
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-dark text-white py-3 mt-4">
    <div class="container">
      <div class="d-flex justify-content-center mb-2">
        <a href="about.html" class="text-white mx-3 text-decoration-none">About Us</a>
        <a href="contact.html" class="text-white mx-3 text-decoration-none">Contact Us</a>
      </div>
      <div class="text-center">
        © 2025 Jobify. All rights reserved.
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  
  <script>
    
    // Shared functions
    function showError(fieldId, message) {
        const field = document.getElementById(fieldId);
        // Clear existing errors for this field
        const existingError = field.parentNode.querySelector('.error-message');
        if (existingError) existingError.remove();
        
        if (message) {
            const errorElement = document.createElement('div');
            errorElement.className = 'error-message text-danger mt-1 small';
            errorElement.textContent = message;
            field.parentNode.appendChild(errorElement);
            field.classList.add('is-invalid');
        } else {
            field.classList.remove('is-invalid');
        }
    }

    function clearAllErrors() {
        document.querySelectorAll('.error-message').forEach(el => el.remove());
        document.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
    }

    // Employer Profile Validation
    function validateCompanyName() {
        const value = document.getElementById('company-name').value.trim();
        if (!value) return showError('company-name', 'Company Name is required');
        if (value.length < 2) return showError('company-name', 'Company Name must be at least 2 characters');
        showError('company-name', '');
        return true;
    }

    function validateLocation() {
        const value = document.getElementById('location').value.trim();
        if (!value) return showError('location', 'Location is required');
        showError('location', '');
        return true;
    }

    function validateIndustry() {
        const value = document.getElementById('industry').value.trim();
        if (!value) return showError('industry', 'Industry is required');
        showError('industry', '');
        return true;
    }

    function validateCompanyDescription() {
        const value = document.getElementById('company-description').value.trim();
        if (!value) return showError('company-description', 'Company Description is required');
        if (value.length < 20) return showError('company-description', 'Description should be at least 20 characters');
        if (value.length > 1000) return showError('company-description', 'Description should not exceed 1000 characters');
        showError('company-description', '');
        return true;
    }

    function validateLogo() {
        const logoInput = document.getElementById('logo');
        if (logoInput.files.length === 0) return showError('logo', 'Company Logo is required');
        
        const file = logoInput.files[0];
        const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
        const maxSize = 2 * 1024 * 1024; // 2MB
        
        if (!allowedTypes.includes(file.type)) return showError('logo', 'Only image files are allowed (JPEG, PNG, GIF)');
        if (file.size > maxSize) return showError('logo', 'File size should not exceed 2MB');
        
        showError('logo', '');
        return true;
    }

    // Post Job Validation
    function validateJobTitle() {
        const value = document.getElementById('job-title').value.trim();
        if (!value) return showError('job-title', 'Job Title is required');
        if (value.length < 3) return showError('job-title', 'Job Title must be at least 3 characters');
        showError('job-title', '');
        return true;
    }

    function validateSalary() {
        const value = document.getElementById('salary').value.trim();
        const salaryRegex = /^(\$|€|£|OMR|AED|)\s*\d{1,3}(,\d{3})*(\.\d{2})?(\s*-\s*(\$|€|£|OMR|AED|)\s*\d{1,3}(,\d{3})*(\.\d{2})?)?$/;
        if (!value) return showError('salary', 'Salary is required');
        if (!salaryRegex.test(value)) return showError('salary', 'Please enter a valid salary range (e.g., $1,000 - $2,000 or OMR 500 - OMR 800)');
        showError('salary', '');
        return true;
    }

    function validateJobDescription() {
        const value = document.getElementById('job-description').value.trim();
        if (!value) return showError('job-description', 'Job Description is required');
        if (value.length < 50) return showError('job-description', 'Description should be at least 50 characters');
        if (value.length > 2000) return showError('job-description', 'Description should not exceed 2000 characters');
        showError('job-description', '');
        return true;
    }

    function validateJobLocation() {
        const value = document.getElementById('job-location').value.trim();
        if (!value) return showError('job-location', 'Location is required');
        showError('job-location', '');
        return true;
    }

    // Combined validation functions
    function validateEmployerProfileForm() {
        clearAllErrors();
        const isValid = validateCompanyName() &&
                       validateLocation() &&
                       validateIndustry() &&
                       validateCompanyDescription() &&
                       validateLogo();
        return isValid;
    }

    function validatePostJobForm() {
        clearAllErrors();
        const isValid = validateJobTitle() &&
                       validateSalary() &&
                       validateJobDescription() &&
                       validateJobLocation();
        return isValid;
    }

    // Form submission handlers
    document.getElementById('employerProfileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (validateEmployerProfileForm()) {
            const companyName = document.getElementById('company-name').value;
            const location = document.getElementById('location').value;
            const industry = document.getElementById('industry').value;
            const description = document.getElementById('company-description').value;
            
            alert('Profile updated successfully!');
            // You would typically submit the form or save the data here
        }
    });
    
    document.getElementById('postJobForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (validatePostJobForm()) {
            const title = document.getElementById('job-title').value;
            const salary = document.getElementById('salary').value;
            const description = document.getElementById('job-description').value;
            const location = document.getElementById('job-location').value;
            const company = document.getElementById('company-name').value || "Your Company";
            
            const newJob = {
                title: title,
                company: company,
                location: location,
                description: description,
                salary: salary
            };
            
            postedJobs.push(newJob);
            displayPostedJobs(postedJobs);
            this.reset();
            alert('Job posted successfully!');
        }
    });

    // Set up event listeners for real-time validation
    // Employer Profile Form
    document.getElementById('company-name').addEventListener('blur', validateCompanyName);
    document.getElementById('location').addEventListener('blur', validateLocation);
    document.getElementById('industry').addEventListener('blur', validateIndustry);
    document.getElementById('company-description').addEventListener('blur', validateCompanyDescription);
    document.getElementById('logo').addEventListener('change', validateLogo);

    // Post Job Form
    document.getElementById('job-title').addEventListener('blur', validateJobTitle);
    document.getElementById('salary').addEventListener('blur', validateSalary);
    document.getElementById('job-description').addEventListener('blur', validateJobDescription);
    document.getElementById('job-location').addEventListener('blur', validateJobLocation);



    // Define an object constructor function for the employers
    function EmployerProfile(companyName, location, industry, description) {
      this.companyName = companyName;
      this.location = location;
      this.industry = industry;
      this.description = description;
    }

    // Define an object constructor function for the job application
    function JobApplication(jobTitle, candidateName, status, lastContact) {
      this.jobTitle = jobTitle;
      this.candidateName = candidateName;
      this.status = status;
      // last contact date with the candidate
      this.lastContact = lastContact || new Date().toLocaleDateString();
    }

        // Initialize an array of posted jobs with thier data
        let postedJobs = [
      {
        title: "Senior Software Engineer",
        company: "TechVision",
        location: "San Francisco, CA",
        description: "Develop high-performance applications and systems. Collaborate with cross-functional teams.",
        salary: "$120,000 - $150,000"
      },
      {
        title: "Application Developer",
        company: "Oman Digital Solutions",
        location: "Muscat, Oman",
        description: "Develops and customizes software applications. Works with a variety of technologies to create user-friendly applications.",
        salary: "OMR 1,200 - OMR 1,800"
      }
    ];

    // Initialize an array of job applications with thier data
    let jobApplications = [
      new JobApplication("Senior Software Engineer", "Sarah Liam", "Under Review"),
      new JobApplication("Product Manager", "Ahmed Ali", "Offer Received")
    ];

    // Functions to display posted jobs in a table
    function displayPostedJobs(jobs) {
      //Get the table body element
      const tableBody = document.getElementById('postedJobsBody');
      // Clear old data from the table
      tableBody.innerHTML = ""; 
      
      // loop through eadch job
      jobs.forEach((job, index) => {
        const row = `<tr>
          <td>${job.title}</td>
          <td>${job.company}</td>
          <td>${job.location}</td>
          <td>${job.description}</td>
          <td>
            <button class="btn btn-sm btn-primary me-1" onclick="viewApplications('${job.title}')">View Apps</button>
            <button class="btn btn-sm btn-danger" onclick="deleteJob(${index})">Delete</button>
          </td>
        </tr>`;
        // Append the row to the table
        tableBody.innerHTML += row;
      });
    }

    // Function to display job application in a table
    function displayApplications(applications) {
      //Get the table body element
      const tableBody = document.getElementById('applicationsBody');
      // Clear old data from the table
      tableBody.innerHTML = ""; 
      
      // loop through each application
      applications.forEach((app, index) => {
        const statusClass = app.status === "Offer Received" ? "text-success" : 
                           app.status === "Under Review" ? "text-warning" : "text-secondary";
        
        const row = `<tr>
          <td>${app.jobTitle}</td>
          <td>${app.candidateName}</td>
          <td><span class="fw-bold ${statusClass}">${app.status}</span></td>
          <td>
            <button class="btn btn-sm btn-primary" onclick="contactCandidate(${index})">
              ${app.status === "Offer Received" ? "Contact" : "Interview"}
            </button>
          </td>
        </tr>`;
        // Append the row to the table
        tableBody.innerHTML += row;
      });
    }

    // Function to display message for the candidates
    function displayCandidateMessages() {
      // Get the container element
      const container = document.getElementById('candidateMessages');
      // clear old data
      container.innerHTML = "";
      
      // loop through each application
      jobApplications.forEach((app, index) => {
        // create a new div for the message
        const messageDiv = document.createElement('div');
        // add styling classes
        messageDiv.className = 'message mb-4';
        messageDiv.innerHTML = `
          <p><strong>${app.candidateName} (${app.jobTitle}):</strong> Last contacted on ${app.lastContact}</p>
          <textarea class="form-control mb-2" id="messageTo${index}" placeholder="Write a message to ${app.candidateName}..."></textarea>
          <button class="btn btn-primary" onclick="sendMessage(${index})">Send Message</button>
        `;
        // Append the div to the container
        container.appendChild(messageDiv);
      });
    }

    // Event Listener for the employer profile form submission
    document.getElementById('employerProfileForm').addEventListener('submit', function(e) {
      e.preventDefault();
      // Get the input values (company name, industry, description)
      const companyName = document.getElementById('company-name').value;
      const location = document.getElementById('location').value;
      const industry = document.getElementById('industry').value;
      const description = document.getElementById('company-description').value;
      
      // message for the user
      alert('Profile updated successfully!');
    });

    // Event Listener for the post job form submission
    document.getElementById('postJobForm').addEventListener('submit', function(e) {
      e.preventDefault();
      // get the input values (job title, salary, description, location)
      const title = document.getElementById('job-title').value;
      const salary = document.getElementById('salary').value;
      const description = document.getElementById('job-description').value;
      const location = document.getElementById('job-location').value;
      const company = document.getElementById('company-name').value || "Your Company";
      
      // save the input value in a variable(newjob)
      const newJob = {
        title: title,
        company: company,
        location: location,
        description: description,
        salary: salary
      };
      
      // Add the new job to the posted jobs
      postedJobs.push(newJob);
      // update the table
      displayPostedJobs(postedJobs);
      // clear the data
      this.reset();
      // message for the user
      alert('Job posted successfully!');
    });

    // Search for a posted job using Event Listener
    document.getElementById('searchJobs').addEventListener('input', function(e) {
      // Get the search text and convert to lowercase
      const searchTerm = e.target.value.toLowerCase();
      const filteredJobs = postedJobs.filter(job => 
        // Fillter by company name and job title
        job.title.toLowerCase().includes(searchTerm) || 
        job.company.toLowerCase().includes(searchTerm)
      );
      // update the table to display filltered results
      displayPostedJobs(filteredJobs);
    });

    // Search for a job application using Event Listener
    document.getElementById('searchApplications').addEventListener('input', function(e) {
      // Get the search text and convert to lowercase
      const searchTerm = e.target.value.toLowerCase();
      const filteredApps = jobApplications.filter(app => 
        // Fillter by candidate name and job title
        app.jobTitle.toLowerCase().includes(searchTerm) || 
        app.candidateName.toLowerCase().includes(searchTerm)
      );
      // update the table to display filltered results
      displayApplications(filteredApps);
    });

    // Function to delete a posted job
    function deleteJob(index) {
      if (confirm('Are you sure you want to delete this job posting?')) {
        // remove the job at the specified index
        postedJobs.splice(index, 1);
        // update the table
        displayPostedJobs(postedJobs);
      }
    }

    // Function to view applications for specific job
    function viewApplications(jobTitle) {
      const appsForJob = jobApplications.filter(app => app.jobTitle === jobTitle);
      // check if there are any applications
      if (appsForJob.length > 0) {
        // Display the filtered applications
        displayApplications(appsForJob);
        // message to notify the user
        alert(`Showing ${appsForJob.length} applications for ${jobTitle}`);
      } else {
        alert(`No applications found for ${jobTitle}`);
      }
    }

    // Function to initiate with a candidate
    function contactCandidate(index) {
      //Get the application at the specified index
      const app = jobApplications[index];
      alert(`Contacting ${app.candidateName} about ${app.jobTitle} position.`);
    }

    // Function to send a message to a candidate
    function sendMessage(index) {
      const messageInput = document.getElementById(`messageTo${index}`);
      const message = messageInput.value.trim();
      
      // validate that the message isn't empty
      if (message) {
        // Get the application at the specified index
        const app = jobApplications[index];
        // Update the last contact date
        app.lastContact = new Date().toLocaleDateString();
        // Message to the user
        alert(`Message sent to ${app.candidateName}: "${message}"`);
        // clear the message
        messageInput.value = '';
        // update the message display
        displayCandidateMessages();
      } else {
        // if the message is empty
        alert('Please enter a message before sending.');
      }
    }

    // Display the initial data when the page load
    displayPostedJobs(postedJobs);
    displayApplications(jobApplications);
    displayCandidateMessages();
  </script>
</body>
</html>